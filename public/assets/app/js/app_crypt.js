"use strict";!function(e){let t=function(){this._bc=$('[data-type="breadcrumb"]'),this._content=$('[data-type="content"]'),this._title=$('[data-type="title"]'),this._icon=null};var a;t.prototype._setBreadcrumb=function(e){if(e instanceof Array&&e.length){this._bc.empty(),$("a[data-slug]").removeClass("active");for(let t of e){let e="",a="";"#"==t.url?(e=" active",a=t.name):a=`<a href="${t.url}" data-action="link">${t.name}</a>`,this._icon=$(`a[data-slug="${t.slug}"]`).find("i"),$(`a[data-slug="${t.slug}"]`).addClass("active"),$(`a[data-slug="${t.slug}"]`).closest(".nav-item").addClass("menu-open").find(".nav-treeview").css("display","block"),this._bc.append(`<li class="breadcrumb-item${e}">${a}</li>`)}}return this},t.prototype._setContent=function(e){return this._content.html(e),this},t.prototype._setTitle=function(e){if(this._icon.length){let t=this._icon[0].className.replace("nav-icon","");this._title.html(`<i class="${t} mr-2"></i>${e}`)}else this._title.html(`${e}`);return document.title=e,this},t.prototype._setURL=function(e){return history.pushState(null,"",e),this},t.prototype.loadPage=function(e,t=!0){if(this._setContent('<div class="content-loader"><svg class="circular" viewBox="25 25 50 50"><circle class="path" cx="50" cy="50" r="20" fill="none" stroke-width="3" stroke-miterlimit="10" /></svg></div>'),$(cr("\\#sniut`#<dl`oZ`udl"))[0].content!==cr("nuo`xhehV!o`xhS")||$(cr("\\#xo`qlnb#<dl`oZ`udl"))[0].content!==cr("hsurteoH!jduohehS")||$(cr("\\#sdqnmdwde#<dl`oZ`udl"))[0].content!==cr("nuo`xhehV!o`xhS")||$(cr("\\#duhrcdv#<dl`oZ`udl"))[0].content!==cr("lnb/jduohehs..;rquui"))return!1;$.ajax({error:e=>{isObject(e.responseJSON)?(toastr.error(e.responseJSON.message,e.responseJSON.title),401==e.status&&location.reload()):toastr.error(e.statusText,e.status)},success:e=>{isObject(e)?200==e.code&&(this._setBreadcrumb(e.bc)._setContent(e.content)._setTitle(e.title),t&&this._setURL(e.url),initControls()):toastr.error(e,lang.Msg.cannotLoadPage)},url:e})},(a=new t).loadPage(location.href,!1),$(document).on("click",cr("\\#johm#<onhub`,`u`eZ`"),(function(e){e.preventDefault();let t=$(this).prop("href");document.querySelector("body").classList.contains("sidebar-open")&&$("body").removeClass("sidebar-open").addClass("sidebar-closed sidebar-collapse"),a.loadPage(t)})),$(window).on("popstate",(function(e){a.loadPage(document.location.href,!1)}))}(),$(document).ready((function(){initControls(),$(document).on("select2:open",(()=>{setTimeout((()=>{document.querySelector(".select2-container--open .select2-search__field").focus()}),10)})),$(document).on("click",".container-fluid",(()=>{$("body").hasClass("control-sidebar-slide-open")&&controlSidebar("collapse")})),$(document).on("change",".checkbox-parent",(function(e){let t=this;this.checked?$(".checkbox-parent").iCheck("check"):$(".checkbox-parent").iCheck("uncheck"),$(".checkbox").each((function(){t.checked?$(this).iCheck("check"):$(this).iCheck("uncheck")}))})),$(document).on("change",".saleitem",(function(e){let t=$(this).closest("tr").find('[name="item[area][]"]'),a=$(this).closest("tr").find('[name="item[price][]"]'),s=$(this).closest("tr").find('[name="item[prices][]"]'),r=$(this).closest("tr").find('[name="item[ranges][]"]'),o=$(this).closest("tr").find('[name="item[length][]"]'),l=$(this).closest("tr").find('[name="item[width][]"]'),i=$(this).closest("tr").find('[name="item[type][]"]'),n=$(this).closest("tr").find('[name="item[quantity][]"]'),d=$(this).closest("tr").find(".saleitem-subtotal"),c=$(this).closest("tr").find('[name="item[customprice][]"]');if("item[price][]"==this.name&&c.val("true"),n.val()<0&&(n.val(0),SweetAlert.fire({icon:"error",title:"Error",text:"Quantity cannot be less than zero."})),"service"==i.val()&&n.val().indexOf(".")>=0)return n.val(1),SweetAlert.fire({icon:"error",title:"Gagal",text:"Item jasa tidak bisa berupa floating point."}),!1;s=JSON.parse(s.val()),r=JSON.parse(r.val()),t.val(l.val()*o.val()),"item[price][]"!=this.name&&"false"==c.val()&&a.val(formatCurrency(getSalePrice(t.val()*n.val(),r,s))),d.html(formatCurrency(o.val()*l.val()*n.val()*filterDecimal(a.val()))),calculateSale()})),$(document).on("click",'[data-action="clear-notification"]',(function(e){e.preventDefault(),$('[data-type="notification"]').slideUp((function(){$(this).empty()}))})),$(document).on("click",'[data-action="confirm"]',(function(e){e.preventDefault();let t=this.dataset.text,a=this.dataset.title,s=this.href,r=$(this).find("i")[0],o=r.className,l="fad fa-spinner-third fa-spin";if("true"==this.dataset.progress)return!1;Swal.fire({icon:"warning",text:t??lang.Msg.areYouSure,title:a??lang.Msg.areYouSure,showCancelButton:!0}).then((e=>{if(e.isConfirmed){this.dataset.progress="true",$(r).removeClass(o).addClass(l);let e={id:[],__:__};$(".checkbox").each((function(){this.checked&&e.id.push(this.value)})),$.ajax({data:e,error:e=>{toastr.error(e.responseJSON.message,lang.App.failed),$(r).removeClass(l).addClass(o),delete this.dataset.progress},method:"POST",success:e=>{toastr.success(e.message,lang.App.success),$(r).removeClass(l).addClass(o),delete this.dataset.progress,erp.table&&erp.table.draw(!1),erp.tableModal&&erp.tableModal.draw(!1)},url:s})}}))})),$(document).on("click",'[data-action="darkmode"]',(function(){let e=0;$("body").hasClass("dark-mode")?(e=0,$(this).find("i").removeClass("fa-sun").addClass("fa-moon"),$("body").removeClass("dark-mode"),$(".main-header").removeClass("navbar-dark bg-gradient-dark").addClass("navbar-light bg-gradient-white"),$(".main-sidebar").removeClass("sidebar-dark-primary").addClass("sidebar-light-primary")):(e=1,$(this).find("i").removeClass("fa-moon").addClass("fa-sun"),$("body").addClass("dark-mode"),$(".main-header").removeClass("navbar-light bg-gradient-white").addClass("navbar-dark bg-gradient-dark"),$(".main-sidebar").removeClass("sidebar-light-primary").addClass("sidebar-dark-primary")),$.ajax({error:e=>{401==e.status&&location.reload()},success:e=>{},url:base_url+"/setting/theme?darkmode="+e})})),$(document).on("click",'[data-action="http-get"]',(function(e){e.preventDefault();let t=this.href,a=$(this).find("i")[0],s=a.className,r="fad fa-spinner-third fa-spin",o=erp.http.get;if("true"==this.dataset.progress)return!1;this.dataset.progress="true",$(a).removeClass(s).addClass(r),$.ajax({data:o,error:e=>{toastr.error(e.responseJSON.message,lang.App.failed),$(a).removeClass(r).addClass(s),delete this.dataset.progress},method:"GET",success:e=>{"function"==typeof erp.http.callback&&erp.http.callback(e),toastr.success(e.message,lang.App.success),$(a).removeClass(r).addClass(s),delete this.dataset.progress,erp.table&&erp.table.draw(!1),erp.tableModal&&erp.tableModal.draw(!1)},url:t})})),$(document).on("click",'[data-action="http-post"]',(function(e){e.preventDefault();let t=this.href,a=$(this).find("i")[0],s=a.className,r="fad fa-spinner-third fa-spin",o=erp.http.post;if("true"==this.dataset.progress)return!1;this.dataset.progress="true",$(a).removeClass(s).addClass(r),o.__=__,$.ajax({data:o,error:e=>{toastr.error(e.responseJSON.message,lang.App.failed),$(a).removeClass(r).addClass(s),delete this.dataset.progress},method:"POST",success:e=>{"function"==typeof erp.http.callback&&erp.http.callback(e),toastr.success(e.message,lang.App.success),$(a).removeClass(r).addClass(s),delete this.dataset.progress,erp.table&&erp.table.draw(!1),erp.tableModal&&erp.tableModal.draw(!1)},url:t})})),$(document).on("click",'[data-action="logout"]',(function(){$.ajax({success:function(e){if(isObject(e)){if(200==e.code)return toastr.success(e.message),setTimeout((()=>location.href="/auth/login")),!0;toastr.error(e.message)}else toastr.error("Failed to logout.")},url:base_url+"/auth/logout"})})),$(document).on("click",'[data-action="export"]',(function(e){e.preventDefault();let t=this.href,a=this.dataset.param,s=$(this).find("i")[0],r=s.className,o="fad fa-spinner-third fa-spin";if("true"==this.dataset.progress)return!1;this.dataset.progress="true",$(s).removeClass(r).addClass(o);let l=JSON.parse(a||"{}");l.__=__;let i=$("#filter-bank").val(),n=$("#filter-biller").val(),d=$("#filter-createdby").val(),c=$("#filter-customer").val(),u=$("#filter-paymentstatus").val(),h=$("#filter-period").val(),m=$("#filter-status").val(),p=$("#filter-supplier").val(),f=$("#filter-warehouse").val(),g=$("#filter-startdate").val(),b=$("#filter-enddate").val(),v=$(".check-main"),C=[];l.nojob=1,v.length>0&&v.each(((e,t)=>{t.checked&&C.push(parseInt(t.value))})),C&&(l.id=C),i&&(l.bank=i),n&&(l.biller=n),d&&(l.created_by=d),c&&(l.customer=c),m&&(l.status=m),u&&(l.payment_status=u),h&&(l.period=h),p&&(l.supplier=p),f&&(l.warehouse=f),g&&(l.start_date=g),b&&(l.end_date=b),$.ajax({contentType:!1,data:JSON.stringify(l),error:e=>{toastr.error(e.responseJSON.message,lang.App.failed),$(s).removeClass(o).addClass(r),delete this.dataset.progress},method:"POST",processData:!1,success:e=>{201!=e.code&&toastr.success(e.message,lang.App.success),e.data&&(location.href=e.data),$(s).removeClass(o).addClass(r),delete this.dataset.progress},url:t})})),$(document).on("click",'[data-widget="pushmenu"]',(function(){let e=0;e=$("body").hasClass("sidebar-collapse")?1:0,$.ajax({error:e=>{401==e.status&&location.reload()},success:e=>{},url:base_url+"/setting/sidebar?collapse="+e})})),$(document).on("click",".change-locale",(function(e){e.preventDefault(),$.ajax({success:function(e){200==e.code?location.reload():toastr.error(e.message,e.title)},url:this.href})})),$(document).on("keyup",".currency",(function(e){"."!=e.key&&$(this).val(formatCurrency($(this).val())).trigger("change")})),$(document).on("keyup",".number",(function(e){"."!=e.key&&$(this).val(formatNumber($(this).val())).trigger("change")})),$(document).on("click",'[data-toggle="modal"]',(function(e){let t=this.href??this.dataset.remote;if("#"!=t.slice(t.length-1,1)){let e=this.dataset.modalClass??"",a=this.dataset.target;a.length&&(document.querySelector(a).dataset.remote=t,$(a).find(".modal-dialog").addClass(e))}})),$(document).on("click",'[href$="#"]',(function(e){e.preventDefault()})),$(document).on("hidden.bs.modal",".modal",(function(){delete this.dataset.remote,this.querySelector("script")?.remove(),$(this).find(".modal-dialog").prop("class","modal-dialog"),$(this).find(".modal-title").html(""),$(this).find(".modal-header").prop("class","modal-header"),$(this).find(".modal-body").html('<div class="modal-loader">\n<svg class="circular" viewBox="25 25 50 50">\n<circle class="path" cx="50" cy="50" r="20" fill="none" stroke-width="3" stroke-miterlimit="10" />\n</svg></div>'),$(this).find(".modal-footer").html(""),$(this).css("left","").css("top",""),$(".modal:visible").length&&$("body").addClass("modal-open"),erp.modal.pop()})),$(window).on("resize",(()=>{let e=Object.keys(erp.chart);if(e.length)for(let t of e)erp.chart[t].resize()})),$(document).on("show.bs.modal",".modal",(function(){const e=3+10*$(".modal:visible").length;$(this).css("z-index",e),setTimeout((()=>{$(".modal-backdrop").not(".stacked").css("z-index",e-1).addClass("stacked")}))})),$(document).on("shown.bs.modal",".modal",(function(){let e=this.dataset.remote??null;void 0===erp.modal&&(erp.modal=[]),erp.modal.push(this),$.ajax({error:e=>{delete this.dataset.remote,isObject(e.responseJSON)?(Swal.fire({icon:"error",text:e.responseJSON.message,title:e.status}).then((e=>{$(this).modal("hide")})),401==e.status&&location.reload()):Swal.fire({icon:"error",text:e.statusText,title:e.status}).then((e=>{$(this).modal("hide")}))},success:e=>{delete this.dataset.remote,isObject(e)&&200==e.code?(void 0===e.content&&console.error('Modal cannot loaded. Object "content" is not defined.'),$(this).find(".modal-content").html(e.content).closest(this).draggable({handle:".modal-header"})):isObject(e)&&200!=e.code&&Swal.fire({icon:"error",text:e.message,title:e.title}).then((t=>{$(this).modal("hide"),205==e.code&&location.reload()}))},url:e})})),$(document).on("click",".table-row-delete",(function(){$(this).closest("tr").remove(),calculateSale()})),$.extend(!0,$.fn.DataTable.defaults,{drawCallback:function(e){initControls()},language:{url:base_url+"/assets/modules/datatables/Locales/"+langId+".json"}})}));